--
-- Script was generated by Devart dbForge Studio 2019 for MySQL, Version 8.2.23.0
-- Product home page: http://www.devart.com/dbforge/mysql/studio
-- Script date 2/5/2020 12:30:32 AM
-- Server version: 5.5.5-10.4.6-MariaDB
-- Client version: 4.1
--

-- 
-- Disable foreign keys
-- 
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;

-- 
-- Set SQL mode
-- 
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;

-- 
-- Set character set the client will use to send SQL statements to the server
--
SET NAMES 'utf8';

--
-- Set default database
--
USE wb;

--
-- Drop table `dim_loan_interest_rates`
--
DROP TABLE IF EXISTS dim_loan_interest_rates;

--
-- Drop table `stg_loans`
--
DROP TABLE IF EXISTS stg_loans;

--
-- Drop table `fct_loans`
--
DROP TABLE IF EXISTS fct_loans;

--
-- Drop table `dim_borrower`
--
DROP TABLE IF EXISTS dim_borrower;

--
-- Drop table `dim_currency`
--
DROP TABLE IF EXISTS dim_currency;

--
-- Drop table `dim_loan_status`
--
DROP TABLE IF EXISTS dim_loan_status;

--
-- Drop table `dim_loan_type`
--
DROP TABLE IF EXISTS dim_loan_type;

--
-- Drop table `dim_project`
--
DROP TABLE IF EXISTS dim_project;

--
-- Drop table `dim_time`
--
DROP TABLE IF EXISTS dim_time;

--
-- Drop table `dim_guarantor`
--
DROP TABLE IF EXISTS dim_guarantor;

--
-- Drop table `dim_country`
--
DROP TABLE IF EXISTS dim_country;

--
-- Drop table `dim_region`
--
DROP TABLE IF EXISTS dim_region;

--
-- Set default database
--
USE wb;

--
-- Create table `dim_region`
--
CREATE TABLE dim_region (
  REGION_KEY INT(11) NOT NULL AUTO_INCREMENT,
  REGION_NAME VARCHAR(255) NOT NULL,
  PRIMARY KEY (REGION_KEY)
)
ENGINE = INNODB,
AUTO_INCREMENT = 3,
AVG_ROW_LENGTH = 8192,
CHARACTER SET latin1,
COLLATE latin1_general_ci;

--
-- Create index `REGION_NAME` on table `dim_region`
--
ALTER TABLE dim_region 
  ADD UNIQUE INDEX REGION_NAME(REGION_NAME);

--
-- Create table `dim_country`
--
CREATE TABLE dim_country (
  COUNTRY_KEY INT(11) NOT NULL AUTO_INCREMENT,
  COUNTRY_CODE VARCHAR(255) NOT NULL,
  COUNTRY_NAME VARCHAR(255) NOT NULL,
  REGION_KEY INT(11) NOT NULL,
  PRIMARY KEY (COUNTRY_KEY)
)
ENGINE = INNODB,
AUTO_INCREMENT = 2,
CHARACTER SET latin1,
COLLATE latin1_general_ci;

--
-- Create index `COUNTRY_CODE` on table `dim_country`
--
ALTER TABLE dim_country 
  ADD UNIQUE INDEX COUNTRY_CODE(COUNTRY_CODE);

--
-- Create index `COUNTRY_NAME` on table `dim_country`
--
ALTER TABLE dim_country 
  ADD UNIQUE INDEX COUNTRY_NAME(COUNTRY_NAME);

--
-- Create foreign key
--
ALTER TABLE dim_country 
  ADD CONSTRAINT FK_dim_country_dim_region_REGION_KEY FOREIGN KEY (REGION_KEY)
    REFERENCES dim_region(REGION_KEY) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Create table `dim_guarantor`
--
CREATE TABLE dim_guarantor (
  GUARANTOR_KEY INT(11) NOT NULL AUTO_INCREMENT,
  GUARANTOR_NAME VARCHAR(255) NOT NULL,
  GUARANTOR_COUNTRY_KEY INT(11) DEFAULT NULL,
  PRIMARY KEY (GUARANTOR_KEY)
)
ENGINE = INNODB,
AUTO_INCREMENT = 2,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci;

--
-- Create index `GUARANTOR_NAME` on table `dim_guarantor`
--
ALTER TABLE dim_guarantor 
  ADD UNIQUE INDEX GUARANTOR_NAME(GUARANTOR_NAME);

--
-- Create foreign key
--
ALTER TABLE dim_guarantor 
  ADD CONSTRAINT FK_dim_guarantor_dim_country_COUNTRY_KEY FOREIGN KEY (GUARANTOR_COUNTRY_KEY)
    REFERENCES dim_country(COUNTRY_KEY) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Create table `dim_time`
--
CREATE TABLE dim_time (
  TIME_KEY VARCHAR(255) NOT NULL,
  YEAR_NUMBER YEAR(4) DEFAULT NULL,
  QUARTER_NUMBER VARCHAR(255) DEFAULT NULL,
  MONTH_NUMBER INT(11) DEFAULT NULL,
  MONTH_NAME VARCHAR(255) DEFAULT NULL,
  DAY_OF_MONTH INT(11) DEFAULT NULL,
  WEEK_NUMBER INT(11) DEFAULT NULL,
  DAY_OF_WEEK VARCHAR(255) DEFAULT NULL,
  CALENDER_DATE DATE DEFAULT NULL,
  PRIMARY KEY (TIME_KEY)
)
ENGINE = INNODB,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci;

--
-- Create table `dim_project`
--
CREATE TABLE dim_project (
  PROJECT_KEY INT(11) NOT NULL AUTO_INCREMENT,
  PROJECT_ID VARCHAR(255) NOT NULL,
  PROJECT_NAME VARCHAR(255) NOT NULL,
  PRIMARY KEY (PROJECT_KEY)
)
ENGINE = INNODB,
AUTO_INCREMENT = 2,
CHARACTER SET latin1,
COLLATE latin1_general_ci;

--
-- Create index `PROJECT_ID` on table `dim_project`
--
ALTER TABLE dim_project 
  ADD UNIQUE INDEX PROJECT_ID(PROJECT_ID);

--
-- Create index `PROJECT_NAME` on table `dim_project`
--
ALTER TABLE dim_project 
  ADD UNIQUE INDEX PROJECT_NAME(PROJECT_NAME);

--
-- Create index `PROJECT_NAME_2` on table `dim_project`
--
ALTER TABLE dim_project 
  ADD UNIQUE INDEX PROJECT_NAME_2(PROJECT_NAME);

--
-- Create table `dim_loan_type`
--
CREATE TABLE dim_loan_type (
  LOAN_TYPE_KEY INT(11) NOT NULL AUTO_INCREMENT,
  LOAN_TYPE_NAME VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (LOAN_TYPE_KEY)
)
ENGINE = INNODB,
AUTO_INCREMENT = 2,
CHARACTER SET latin1,
COLLATE latin1_general_ci;

--
-- Create table `dim_loan_status`
--
CREATE TABLE dim_loan_status (
  LOAN_STATUS_KEY INT(11) NOT NULL AUTO_INCREMENT,
  LOAN_STATUS VARCHAR(255) NOT NULL,
  PRIMARY KEY (LOAN_STATUS_KEY)
)
ENGINE = INNODB,
AUTO_INCREMENT = 2,
CHARACTER SET latin1,
COLLATE latin1_general_ci;

--
-- Create index `LOAN_STATUS` on table `dim_loan_status`
--
ALTER TABLE dim_loan_status 
  ADD UNIQUE INDEX LOAN_STATUS(LOAN_STATUS);

--
-- Create table `dim_currency`
--
CREATE TABLE dim_currency (
  CURRENCY_KEY INT(11) NOT NULL AUTO_INCREMENT,
  CURRENCY_NAME VARCHAR(255) NOT NULL,
  PRIMARY KEY (CURRENCY_KEY)
)
ENGINE = INNODB,
AUTO_INCREMENT = 10,
AVG_ROW_LENGTH = 16384,
CHARACTER SET latin1,
COLLATE latin1_general_ci;

--
-- Create index `CURRENCY_NAME` on table `dim_currency`
--
ALTER TABLE dim_currency 
  ADD UNIQUE INDEX CURRENCY_NAME(CURRENCY_NAME);

--
-- Create table `dim_borrower`
--
CREATE TABLE dim_borrower (
  BORROWER_KEY INT(11) NOT NULL AUTO_INCREMENT,
  BORROWER_NAME VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (BORROWER_KEY)
)
ENGINE = INNODB,
AUTO_INCREMENT = 2,
CHARACTER SET latin1,
COLLATE latin1_general_ci;

--
-- Create table `fct_loans`
--
CREATE TABLE fct_loans (
  LOAN_KEY INT(11) NOT NULL AUTO_INCREMENT,
  END_OF_PERIOD_KEY VARCHAR(255) DEFAULT NULL,
  LOAN_CREDIT_NUMBER INT(11) DEFAULT NULL,
  LOAN_STATUS_KEY INT(11) DEFAULT NULL,
  LOAN_TYPE_KEY INT(11) DEFAULT NULL,
  PROJECT_KEY INT(11) DEFAULT NULL,
  BORROWER_KEY INT(11) DEFAULT NULL,
  COUNTRY_KEY INT(11) DEFAULT NULL,
  CURRENCY_KEY INT(11) DEFAULT NULL,
  GUARANTOR_KEY INT(11) DEFAULT NULL,
  INTEREST_RATE DECIMAL(13, 2) DEFAULT NULL,
  ORIGINAL_PRICINCIPAL_AMOUNT DECIMAL(13, 2) DEFAULT NULL,
  CANCELLED_AMOUNT DECIMAL(13, 2) DEFAULT NULL,
  UNDISBURSED_AMOUNT DECIMAL(13, 2) DEFAULT NULL,
  DISBURSED_AMOUNT DECIMAL(13, 2) DEFAULT NULL,
  REPAID_TO_IBRD DECIMAL(13, 2) DEFAULT NULL,
  DUE_TO_IBRD DECIMAL(13, 2) DEFAULT NULL,
  EXCHANGE_ADJUSTMENT DECIMAL(13, 2) DEFAULT NULL,
  BORROWERS_OBLIGATION DECIMAL(13, 2) DEFAULT NULL,
  SOLD_THIRD_PARTY DECIMAL(13, 2) DEFAULT NULL,
  REPAID_THIRD_PARTY DECIMAL(13, 2) DEFAULT NULL,
  DUE_THIRD_PARTY DECIMAL(13, 2) DEFAULT NULL,
  LOANS_HELD DECIMAL(13, 2) DEFAULT NULL,
  FIRST_REPAYMENT_DATE VARCHAR(255) DEFAULT NULL,
  LAST_REPAYMENT_DATE VARCHAR(255) DEFAULT NULL,
  AGREEMENT_SIGNING_DATE VARCHAR(255) DEFAULT NULL,
  BOARD_APPROVAL_DATE VARCHAR(255) DEFAULT NULL,
  EFFECTIVE_DATE VARCHAR(255) DEFAULT NULL,
  CLOSED_DATE VARCHAR(255) DEFAULT NULL,
  LAST_DISBURSEMENT_DATE VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (LOAN_KEY)
)
ENGINE = INNODB,
AUTO_INCREMENT = 6,
AVG_ROW_LENGTH = 16384,
CHARACTER SET latin1,
COLLATE latin1_general_ci;

--
-- Create index `FK_ft_loan_dim_country_GUARANTOR_COUNTRY_KEY` on table `fct_loans`
--
ALTER TABLE fct_loans 
  ADD INDEX FK_ft_loan_dim_country_GUARANTOR_COUNTRY_KEY(GUARANTOR_KEY);

--
-- Create foreign key
--
ALTER TABLE fct_loans 
  ADD CONSTRAINT FK_ft_loan FOREIGN KEY (BORROWER_KEY)
    REFERENCES dim_borrower(BORROWER_KEY) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Create foreign key
--
ALTER TABLE fct_loans 
  ADD CONSTRAINT FK_ft_loan_dim_country_COUNTRY_KEY FOREIGN KEY (COUNTRY_KEY)
    REFERENCES dim_country(COUNTRY_KEY) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Create foreign key
--
ALTER TABLE fct_loans 
  ADD CONSTRAINT FK_ft_loan_dim_currency_CURRENCY_KEY FOREIGN KEY (CURRENCY_KEY)
    REFERENCES dim_currency(CURRENCY_KEY) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Create foreign key
--
ALTER TABLE fct_loans 
  ADD CONSTRAINT FK_ft_loan_dim_guarantor_GUARANTOR_KEY FOREIGN KEY (GUARANTOR_KEY)
    REFERENCES dim_guarantor(GUARANTOR_KEY) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Create foreign key
--
ALTER TABLE fct_loans 
  ADD CONSTRAINT FK_ft_loan_dim_loan_status_LOAN_STATUS_KEY FOREIGN KEY (LOAN_STATUS_KEY)
    REFERENCES dim_loan_status(LOAN_STATUS_KEY) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Create foreign key
--
ALTER TABLE fct_loans 
  ADD CONSTRAINT FK_ft_loan_dim_loan_type_LOAN_TYPE_KEY FOREIGN KEY (LOAN_TYPE_KEY)
    REFERENCES dim_loan_type(LOAN_TYPE_KEY) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Create foreign key
--
ALTER TABLE fct_loans 
  ADD CONSTRAINT FK_ft_loan_dim_project_PROJECT_KEY FOREIGN KEY (PROJECT_KEY)
    REFERENCES dim_project(PROJECT_KEY) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Create foreign key
--
ALTER TABLE fct_loans 
  ADD CONSTRAINT FK_ft_loan_dim_time_TIME_KEY FOREIGN KEY (END_OF_PERIOD_KEY)
    REFERENCES dim_time(TIME_KEY) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Create table `stg_loans`
--
CREATE TABLE stg_loans (
  ID INT(11) NOT NULL AUTO_INCREMENT,
  LOAD_DATE DATE DEFAULT current_timestamp(),
  END_OF_PERIOD DATE DEFAULT NULL,
  LOAN_NUMBER VARCHAR(255) DEFAULT NULL,
  REGION VARCHAR(255) DEFAULT NULL,
  COUNTRY VARCHAR(255) DEFAULT NULL,
  COUNTRY_CODE VARCHAR(255) DEFAULT NULL,
  BORROWER VARCHAR(255) DEFAULT NULL,
  GUARANTOR_COUNTRY_CODE VARCHAR(255) DEFAULT NULL,
  GUARANTOR VARCHAR(255) DEFAULT NULL,
  LOAN_TYPE VARCHAR(255) DEFAULT NULL,
  LOAN_STATUS VARCHAR(255) DEFAULT NULL,
  INTEREST_RATE VARCHAR(255) DEFAULT NULL,
  CURRENCY_OF_COMMITMENT VARCHAR(255) DEFAULT NULL,
  PROJECT_ID VARCHAR(255) DEFAULT NULL,
  PROJECT_NAME VARCHAR(255) DEFAULT NULL,
  ORIGINAL_PRICINCIPAL_AMOUNT DECIMAL(13, 2) DEFAULT NULL,
  CANCELLED_AMOUNT DECIMAL(13, 2) DEFAULT NULL,
  UNDISBURSED_AMOUNT DECIMAL(13, 2) DEFAULT NULL,
  DISBURSED_AMOUNT DECIMAL(13, 2) DEFAULT NULL,
  REPAID_TO_IBRD DECIMAL(13, 2) DEFAULT NULL,
  DUE_TO_IBRD DECIMAL(13, 2) DEFAULT NULL,
  EXCHANGE_ADJUSTMENT DECIMAL(13, 2) DEFAULT NULL,
  BORROWERS_OBLIGATION DECIMAL(13, 2) DEFAULT NULL,
  SOLD_THIRD_PARTY DECIMAL(13, 2) DEFAULT NULL,
  REPAID_THIRD_PARTY DECIMAL(13, 2) DEFAULT NULL,
  DUE_THIRD_PARTY DECIMAL(13, 2) DEFAULT NULL,
  LOANS_HELD DECIMAL(13, 2) DEFAULT NULL,
  FIRST_REPAYMENT_DATE DATE DEFAULT NULL,
  LAST_REPAYMENT_DATE DATE DEFAULT NULL,
  AGREEMENT_SIGNING_DATE DATE DEFAULT NULL,
  BOARD_APPROVAL_DATE DATE DEFAULT NULL,
  EFFECTIVE_DATE DATE DEFAULT NULL,
  CLOSED_DATE DATE DEFAULT NULL,
  LAST_DISBURSEMENT_DATE DATE DEFAULT NULL,
  ETL INT(11) DEFAULT 0,
  PRIMARY KEY (ID)
)
ENGINE = INNODB,
AUTO_INCREMENT = 2,
CHARACTER SET latin1,
COLLATE latin1_general_ci;

--
-- Create table `dim_loan_interest_rates`
--
CREATE TABLE dim_loan_interest_rates (
  LOAN_INT_RATE_KEY INT(11) NOT NULL AUTO_INCREMENT,
  INTEREST_SC_RATE DECIMAL(10, 0) DEFAULT NULL,
  PRIMARY KEY (LOAN_INT_RATE_KEY)
)
ENGINE = INNODB,
CHARACTER SET latin1,
COLLATE latin1_general_ci;

-- 
-- Dumping data for table dim_region
--
INSERT INTO dim_region VALUES
(2, 'CREDIT NATIONAL'),
(1, 'EUROPE AND CENTRAL ASIA');

-- 
-- Dumping data for table dim_country
--
INSERT INTO dim_country VALUES
(1, 'FR', 'FRANCE', 1);

-- 
-- Dumping data for table dim_time
--
INSERT INTO dim_time VALUES
('20110430', 2011, 'Q2', 4, 'Apr', 30, 17, 'Sat', '2011-04-30');

-- 
-- Dumping data for table dim_project
--
INSERT INTO dim_project VALUES
(1, 'P037383', 'RECONSTRUCTION');

-- 
-- Dumping data for table dim_loan_type
--
INSERT INTO dim_loan_type VALUES
(1, 'NON POOL');

-- 
-- Dumping data for table dim_loan_status
--
INSERT INTO dim_loan_status VALUES
(1, 'REPAID');

-- 
-- Dumping data for table dim_guarantor
--
INSERT INTO dim_guarantor VALUES
(1, 'FRANCE', 1);

-- 
-- Dumping data for table dim_currency
--
INSERT INTO dim_currency VALUES
(1, 'UGX');

-- 
-- Dumping data for table dim_borrower
--
INSERT INTO dim_borrower VALUES
(1, 'CREDIT NATIONAL');

-- 
-- Dumping data for table stg_loans
--
INSERT INTO stg_loans VALUES
(1, '2020-02-03', '2011-04-30', 'IBRD00010', 'EUROPE AND CENTRAL ASIA', 'FR', 'France', 'CREDIT NATIONAL', 'FR', 'France', 'NON POOL', 'Repaid', '4.25', '', 'P037383', 'RECONSTRUCTION', 250000000.00, 0.00, 0.00, 250000000.00, 38000.00, 0.00, 0.00, 0.00, 249962000.00, 249962000.00, 0.00, 0.00, '1952-11-01', '1977-05-01', '1947-05-09', '1947-05-09', '1947-06-09', '1947-12-31', '0000-00-00', 0);

-- 
-- Dumping data for table fct_loans
--
INSERT INTO fct_loans VALUES
(5, '20110430', 0, 1, 1, 1, 1, 1, NULL, 1, 4.25, 250000000.00, 0.00, 0.00, 250000000.00, 38000.00, 0.00, 0.00, 0.00, 249962000.00, 249962000.00, 0.00, 0.00, '19521101', '19770501', '19470509', '19470509', '19470609', '19471231', NULL);

-- 
-- Dumping data for table dim_loan_interest_rates
--
-- Table wb.dim_loan_interest_rates does not contain any data (it is empty)

-- 
-- Restore previous SQL mode
-- 
/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;

-- 
-- Enable foreign keys
-- 
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;